<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/welcome.css">
	<link rel="stylesheet" href="style.css">
	<script defer src="/script.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
	<title>Contact us</title>
</head>
<body>
	<div id="wrapper">
	
		<!-- Header -->
		<div id="header-placeholder"></div>
		
		<script>
			fetch("/header.html")
				.then(response => response.text())
				.then(data => {
				document.getElementById("header-placeholder").innerHTML = data;
				});
		</script>
		
		<!-- Secciones -->
		<section class="sections">
			<div class="form_container">
				<h1>Contact us:</h1>
				<form id="userForm" method="POST" action="/contact/files/">
					<input type="text" name="name" id="name" placeholder="Name:" required>
					<input type="text" name="user" id="user" placeholder="User:" required>
					<input type="number" name="age" id="age" placeholder="Age:" required>
					<textarea id="message" name="message" rows="5" placeholder="Message:"></textarea>
					<button type="submit">Contact <i class="fa-solid fa-paper-plane"></i></button>
				</form>
			</div>

			<div id="respuesta"></div>
		</section>

		<script>
			const form = document.getElementById('userForm');
			form.addEventListener('submit', async (e) => {
				e.preventDefault();

				const name = document.getElementById('name').value;
				const user = document.getElementById('user').value;
				const age = document.getElementById('age').value;
				const message = document.getElementById('message').value;

				const content = `Name: ${name}\nUser: ${user}\nAge: ${age}\nMessage: ${message}`;

				const blob = new Blob([content], { type: 'text/plain' });
				const timestamp = new Date().toISOString().replace(/[:.-]/g, '');
				const filename = `${name}_${timestamp}.txt`;

				const formData = new FormData();
				formData.append(`${user}_${Date.now()}`, blob, filename);

				const response = await fetch('/contact/files/', {
				method: 'POST',
				body: formData
				});

				const result = await response.text();
				alert(`Message sent:\n${content}`);
				// document.getElementById('respuesta').innerText = result;
				showToast(result);

				function showToast(message)
				{
					const toast = document.getElementById('respuesta');
					toast.textContent = message;
					toast.classList.add('show');
					setTimeout(() => {
						toast.classList.remove('show');
					}, 3000);
				}
			});
		</script>

		<!-- Footer -->
		
		<div id="footer-placeholder"></div>

		<script>
			fetch("/footer.html")
				.then(response => response.text())
				.then(data => {
				document.getElementById("footer-placeholder").innerHTML = data;
				});
		</script>
	</div>
</body>
</html>